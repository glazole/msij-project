###############################################
# Spark Defaults Configuration
# Упрощённый и оптимизированный вариант
###############################################

# === Кластер ===
spark.master                              spark://spark-master:7077
spark.driver.bindAddress                  0.0.0.0
spark.driver.host                         jupyter

# === S3A / MinIO ===
spark.hadoop.fs.s3a.endpoint              http://minio:9000
spark.hadoop.fs.s3a.path.style.access     true
spark.hadoop.fs.s3a.connection.ssl.enabled false
spark.hadoop.fs.s3a.impl                  org.apache.hadoop.fs.s3a.S3AFileSystem
spark.hadoop.fs.s3a.access.key            minio
spark.hadoop.fs.s3a.secret.key            minio_minio

##########################################################
# === Iceberg Catalogs ===
# Вариант 1 (Hadoop) — отключён по умолчанию
##########################################################
# spark.sql.extensions                      org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions
# spark.sql.catalog.ice                     org.apache.iceberg.spark.SparkCatalog
# spark.sql.catalog.ice.type                hadoop
# spark.sql.catalog.ice.warehouse           s3a://warehouse/iceberg/
# spark.sql.defaultCatalog                  ice

##########################################################
# Вариант 2 (REST) — активный
##########################################################
spark.sql.extensions                        org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions
spark.sql.catalog.ice                       org.apache.iceberg.spark.SparkCatalog
spark.sql.catalog.ice.type                  rest
spark.sql.catalog.ice.uri                   http://iceberg-rest:8181
spark.sql.catalog.ice.warehouse             s3a://warehouse/iceberg/
spark.sql.catalog.ice.io-impl               org.apache.iceberg.aws.s3.S3FileIO
spark.sql.catalog.ice.s3.endpoint           http://minio:9000
spark.sql.catalog.ice.s3.path-style-access  true
spark.sql.catalog.ice.s3.region             us-east-1
spark.sql.catalog.ice.s3.access-key-id      minio
spark.sql.catalog.ice.s3.secret-access-key  minio_minio
spark.sql.defaultCatalog                    ice

# === Ресурсы и производительность ===
spark.serializer                            org.apache.spark.serializer.KryoSerializer
spark.sql.shuffle.partitions                48
spark.executor.instances                    1
spark.executor.cores                        1
spark.executor.memory                       2g
spark.driver.memory                         3g
spark.cores.max                             1
spark.dynamicAllocation.enabled             false
# Адаптивная оптимизация (Spark 3)
spark.sql.adaptive.enabled                       true
spark.sql.adaptive.skewJoin.enabled              true
spark.sql.adaptive.coalescePartitions.enabled    true
spark.sql.adaptive.advisoryPartitionSizeInBytes  64m
spark.sql.autoBroadcastJoinThreshold             64m    
# или больше, если сеть/память позволяют
spark.sql.broadcastTimeout                       360

# === Event Log ===
spark.eventLog.enabled                         true
spark.eventLog.compress                        true
spark.eventLog.dir                              s3a://warehouse/spark-events/

# === Прочее ===
spark.driver.extraJavaOptions   -Duser.name=spark -Daws.region=us-east-1
spark.executor.extraJavaOptions -Duser.name=spark -Daws.region=us-east-1

spark.jars /opt/bitnami/spark/jars/hadoop-aws-3.3.4.jar,\
/opt/bitnami/spark/jars/aws-java-sdk-bundle-1.12.517.jar,\
/opt/bitnami/spark/jars/iceberg-spark-runtime-3.5_2.12-1.6.1.jar,\
/opt/bitnami/spark/jars/postgresql-42.7.2.jar,\
/opt/bitnami/spark/jars/graphframes-spark3_2.12-0.9.0-spark3.5.jar


